{"version":3,"sources":["mpp.js"],"names":["jQuery","document","ready","$","post_id","val","mt_ajax_thumbnail_refresh","html","metronet_profile_image","loading_gif","post","ajax_url","mt_display_block","response","thumb_html","user_id","logged_in_user_id","replaceWith","avatar_admin_small","mt_remove_profile_image","action","user_post_id","_wpnonce","nonce","avatar","avatar_admin_medium","temp","firstElementChild","innerHTML","htmlString","style","display","uploader","media","e","states","button","wp","text","controller","FeaturedImage","multiple","set_profile_text","remove_profile_text","options","click","requires","selection","event","reset","close","view","Toolbar","Select","prototype","clickSelect","state","syncSelection","hasClass","createSelectToolbar","toolbar","id","thumbnail_id","mt_featured_set","featured","get","single","featuredImage","set","on","open","preventDefault"],"mappings":"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","file":"mpp.min.js","sourcesContent":["jQuery( document ).ready( function( $ ) {\n\t//Refresh the profile image thumbnail\n\tfunction mt_ajax_thumbnail_refresh() {\n\t\tvar post_id = jQuery( \"#metronet_post_id\" ).val();\n\t\tjQuery( '#metronet-profile-image' ).html( '<img class=\"mpp-loading\" alt=\"Loading\" width=\"150\" height=\"150\" src=\"' + metronet_profile_image.loading_gif + '\" />' );\n\t\t$.post( metronet_profile_image.ajax_url, { \n\t\t\t\taction: 'metronet_get_thumbnail', \n\t\t\t\tpost_id: post_id, \n\t\t\t}, \n\t\t\tfunction( response ) {\n\t\t\t\tjQuery( \"#metronet-profile-image\" ).html( mt_display_block( response.thumb_html ) );\n\t\t\t\tjQuery( '.user-profile-picture img ').replaceWith( response.avatar );\n\t\t\t\tif ( response.user_id === response.logged_in_user_id ) {\n\t\t\t\t\tjQuery( '#wp-admin-bar-my-account img.avatar-26' ).replaceWith( response.avatar_admin_small );\n\t\t\t\t\tjQuery( '#wp-admin-bar-my-account img.avatar-64' ).replaceWith( response.avatar_admin_medium );\n\t\t\t\t}\n\t\t\t},\n\t\t\t'json'\n\t\t);\n\t};\n\t//Remove the profile image\n\tfunction mt_remove_profile_image() {\n\t\tjQuery( '#metronet-profile-image' ).html( '<img class=\"mpp-loading\" alt=\"Loading\" width=\"150\" height=\"150\" src=\"' + metronet_profile_image.loading_gif + '\" />' );\n\t\t$.post( metronet_profile_image.ajax_url, { \n\t\t\t\taction: 'metronet_remove_thumbnail', \n\t\t\t\tpost_id: metronet_profile_image.user_post_id, \n\t\t\t\tuser_id: jQuery( \"#metronet_profile_id\" ).val(), \n\t\t\t\t_wpnonce: metronet_profile_image.nonce\n\t\t\t}, \n\t\t\tfunction( response ) {\n\t\t\t\tjQuery( \"#metronet-profile-image\" ).html( mt_display_block( response.thumb_html ) );\n\t\t\t\tjQuery( '.user-profile-picture img ').replaceWith( response.avatar );\n\t\t\t\tif ( response.user_id === response.logged_in_user_id ) {\n\t\t\t\t\tjQuery( '#wp-admin-bar-my-account img.avatar-26' ).replaceWith( response.avatar_admin_small );\n\t\t\t\t\tjQuery( '#wp-admin-bar-my-account img.avatar-64' ).replaceWith( response.avatar_admin_medium );\n\t\t\t\t}\n\t\t\t},\n\t\t\t'json'\n\t\t);\t\n\t}\n\t// Set thumbnail img and wrapping a to display:block to fix visual bug\n\tfunction mt_display_block(htmlString) {\n\t\tvar temp = document.createElement('div');\n\t\ttemp.innerHTML = htmlString;\n\t\ttemp.firstElementChild.style.display = 'block';\n\t\ttemp.firstElementChild.firstElementChild.style.display = 'block';\n\t\treturn temp.innerHTML;\n\t}\n\t\n\t$('#mpp').on( \"click\", '.mpp_add_media', function(e) {\n\n\t\t//Assign the default view for the media uploader\n\n\t\tvar uploader = wp.media({\n\t\t\tstate: 'featured-image',\n\t\t\tstates: [ new wp.media.controller.FeaturedImage() ],\n\t\t\ttitle: metronet_profile_image.set_profile_text,\n\t\t\tbutton: {\n\t\t\t\ttext: metronet_profile_image.remove_profile_text\n\t\t\t},\n\t\t\tmultiple: false,\n\t\t});\n\n\t\t// CUSTOM TOOLBAR ON BOTTOM OF MEDIA MANAGER. SETS UP THE TWO ACTION BUTTONS\n\n\t\tuploader.on( 'toolbar:create', function( toolbar ) {\n\t\t\tvar options = {};\n\t\t\toptions.items = {};\n\t\t\toptions.items.select = {\n\t\t\t\ttext: metronet_profile_image.set_profile_text,\n\t\t\t\tstyle: 'primary',\n\t\t\t\tclick: wp.media.view.Toolbar.Select.prototype.clickSelect,\n\t\t\t\trequires: { selection: true },\n\t\t\t\tevent: 'select',\n\t\t\t\treset: false,\n\t\t\t\tclose: true,\n\t\t\t\tstate: false,\n\t\t\t\tsyncSelection: true\n\t\t\t};\n\t\t\tif ( ! $( '#metronet-profile-image a' ).hasClass('default-image') ) {\n\t\t\t\toptions.items.remove = {\n\t\t\t\t\ttext: metronet_profile_image.remove_profile_text,\n\t\t\t\t\tstyle:    'secondary',\n\t\t\t\t\trequires: { selection: false },\n\t\t\t\t\tclick: wp.media.view.Toolbar.Select.prototype.clickSelect,\n\t\t\t\t\tevent: 'remove',\n\t\t\t\t\treset: true,\n\t\t\t\t\tclose: true,\n\t\t\t\t\tstate: false,\n\t\t\t\t\tsyncSelection: true\n\t\t\t\t};\n\t\t\t}\n\t\t\tthis.createSelectToolbar( toolbar, options );\n\t\t}, uploader );\n\t\t\t\n\t\t\n\t\t//For when the featured thumbnail is set\n\t\tuploader.mt_featured_set = function( id ) {\n\t\t\tjQuery( '#metronet-profile-image' ).html( '<img class=\"mpp-loading\" alt=\"Loading\" width=\"150\" height=\"150\" src=\"' + metronet_profile_image.loading_gif + '\" />' );\n\t\t\t$.post( metronet_profile_image.ajax_url, { \n\t\t\t\t\taction: 'metronet_add_thumbnail', \n\t\t\t\t\tpost_id: metronet_profile_image.user_post_id, \n\t\t\t\t\tuser_id: jQuery( \"#metronet_profile_id\" ).val(), \n\t\t\t\t\tthumbnail_id: id,\n\t\t\t\t\t_wpnonce: metronet_profile_image.nonce \n\t\t\t\t}, \n\t\t\t\tfunction( response ) {\n\t\t\t\t\tjQuery( \"#metronet-profile-image\" ).html( mt_display_block( response.thumb_html ) );\n\t\t\t\t\tjQuery( '.user-profile-picture img ').replaceWith( response.avatar );\n\t\t\t\t\tif ( response.user_id === response.logged_in_user_id ) {\n\t\t\t\t\t\tjQuery( '#wp-admin-bar-my-account img.avatar-26' ).replaceWith( response.avatar_admin_small );\n\t\t\t\t\t\tjQuery( '#wp-admin-bar-my-account img.avatar-64' ).replaceWith( response.avatar_admin_medium );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t'json'\n\t\t\t);\n\t\t};\n\t\t\n\t\t//For when the Add Profile Image is clicked\n\t\tuploader.on( 'select', function() {\n\n\t\t\tvar featured = uploader.state().get('selection').single();\n\t\t\twp.media.featuredImage.set( featured ? featured.id : -1 );\n\t\t\tif ( ! featured.id ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tuploader.mt_featured_set( featured.id );\n\t\t\t\n\n\t\t} );\n\t\t\n\t\t//When the remove buttons is clicked\n\t\tuploader.on( 'remove', function() {\n\t\t\twp.media.featuredImage.set( -1 );\n\t\t\tmt_remove_profile_image();\n\t\t} );\n\t\t\n\t\t\t\t\n\t\t//For when the window is closed (update the thumbnail)\n\t\tuploader.on('escape', function(){\n\t\t\tmt_ajax_thumbnail_refresh();\n\t\t});\n\t\t\n\t\t//Open the media uploader\n\t\tuploader.open();\n\t\treturn false;\n\t});\n\t$( \"#mpp\" ).on( 'click', 'a#metronet-remove', function( e ) {\n\t\te.preventDefault();\n\t\twp.media.featuredImage.set( -1 );\n\t\tmt_remove_profile_image();\n\t} );\n\t\n} );"]}